#! /bin/sh
set -eux

mkdir build
cd build

if test 0 -eq $EUID
then cmake ..
else cmake .. -DCMAKE_INSTALL_PREIX="$HOME"
fi

make
make test
make check
make install
make installcheck

if test 0 -eq $EUID
then make pathcheck
fi

make format
git diff --exit-code
test -z "$(git ls-files --exclude-standard --directory --other)"
